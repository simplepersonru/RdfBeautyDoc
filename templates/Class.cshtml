@using Microsoft.AspNetCore.Html
@using RdfsBeautyDoc
@model ClassViewModel
@{
    Layout = "_Layout.cshtml";
}

<h1>@Model.Class.Id <small class="text-muted">@GetStereotypeBadge(Model.Class.Stereotype)</small></h1>

@if (!string.IsNullOrEmpty(Model.Class.Label))
{
    <p class="lead">@Model.Class.Label</p>
}

@if (!string.IsNullOrEmpty(Model.Class.Comment))
{
    <div class="alert alert-info">@Model.Class.Comment</div>
}

@if (!string.IsNullOrEmpty(Model.Class.SvgDiagram))
{
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Diagram</h5>
        </div>
        <div class="card-body diagram-container">
            @(new Microsoft.AspNetCore.Html.HtmlString(Model.Class.SvgDiagram))
        </div>
    </div>
}

<div class="row mt-4">
    <div class="col-lg-8">
        <!-- –°–≤–æ–π—Å—Ç–≤–∞ –∫–ª–∞—Å—Å–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤) -->
        @if (Model.Class.Stereotype == Stereotype.Class && Model.Properties.Any())
        {
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">–°–≤–æ–π—Å—Ç–≤–∞ (@Model.Properties.Count)</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>ID</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–ü–æ–¥–ø–∏—Å—å</th>
                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var prop in Model.Properties)
                                {
                                    <tr class="searchable">
                                        <td>
                                            <a href="/properties/@(prop.Id).html" class="text-decoration-none">
                                                @prop.FieldName
                                            </a>
                                        </td>
                                        <td>
                                            @if (prop.Range != null)
                                            {
                                                <a href="/@(prop.Range.StereoPath)/@(prop.Range.Id).html" class="badge @(prop.Range.BadgeClass) text-decoration-none">
                                                    @prop.Range
                                                </a>
                                            }
                                            else
                                            {
                                                <code>@prop.Range</code>
                                            }
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(prop.Label))
                                            {
                                                <small class="text-muted">@prop.Label</small>
                                            }
                                            else
                                            {
                                                <span class="text-muted">‚Äî</span>
                                            }
                                        </td>
  
                                        <td>
                                            @if (!string.IsNullOrEmpty(prop.Multiplicity))
                                            {
                                                <span class="badge bg-info">@prop.Multiplicity</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">‚Äî</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }

        <!-- –≠–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è enums) -->
        @if (Model.Class.Stereotype == Stereotype.Enum && Model.Class.Descriptions.Any())
        {
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Enumeration Values (@Model.Class.Descriptions.Count)</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Value</th>
                                    <th>Label</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var desc in Model.Class.Descriptions.Values)
                                {
                                    <tr class="searchable">
                                        <td>
                                            <code>@desc.Id</code>
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(desc.Label))
                                            {
                                                <span>@desc.Label</span>
                                            }
                                            else
                                            {
                                                <span>‚Äî</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }

        <!-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–≥–¥–µ —ç—Ç–æ—Ç –∫–ª–∞—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ range) -->
        @{
            var usedInProperties = Model.AllProperties
            .Where(p => p.Range == Model.Class.Id)
            .ToList();
        }

        @if (usedInProperties.Any())
        {
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">–°—Å—ã–ª–∫–∏ (@usedInProperties.Count)</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>–ö–ª–∞—Å—Å</th>
                                    <th>–°–≤–æ–π—Å—Ç–≤–æ</th>
                                    <th>–ü–æ–¥–ø–∏—Å—å</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var prop in usedInProperties)
                                {
                                    <tr class="searchable">
                                        <td>
                                            <a href="/@(prop.Domain.StereoPath)/@(prop.Domain.Id).html" class="badge badge-class text-decoration-none">
                                                @prop.Domain.Id
                                            </a>
                                        </td>
                                        <td>
                                            <a href="/properties/@(prop.Id).html" class="badge badge-property text-decoration-none">
                                                @prop.FieldName
                                            </a>
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(prop.Label))
                                            {
                                                <p>@prop.Label</p>
                                            }
                                            else
                                            {
                                                <p>‚Äî</p>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }

        @if (Model.ChildClasses.Any())
        {
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">–î–æ—á–µ—Ä–Ω–∏–µ –∫–ª–∞—Å—Å—ã (@Model.ChildClasses.Count)</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>–ö–ª–∞—Å—Å</th>
                                    <th>–ü–æ–¥–ø–∏—Å—å</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var cls in Model.ChildClasses)
                                {
                                    <tr class="searchable">
                                        <td>
                                            <a href="/@(cls.StereoPath)/@(cls.Id).html" class="badge badge-class text-decoration-none">
                                                @cls.Id
                                            </a>
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(cls.Label))
                                            {
                                                <p>@cls.Label</p>
                                            }
                                            else
                                            {
                                                <p>‚Äî</p>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }

    </div>

    <div class="col-lg-4">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ -->
        <div class="card mb-3">
            <div class="card-header">
                <h6 class="mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ</h6>
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-4">ID</dt>
                    <dd class="col-sm-8"><code>@Model.Class.Id</code></dd>

                    <dt class="col-sm-4">–¢–∏–ø</dt>
                    <dd class="col-sm-8">@GetStereotypeBadge(Model.Class.Stereotype)</dd>

                    @if (!string.IsNullOrEmpty(Model.Class.Label))
                    {
                        <dt class="col-sm-4">–ü–æ–¥–ø–∏—Å—å</dt>
                        <dd class="col-sm-8">@Model.Class.Label</dd>
                    }

                    @if (Model.Class.SubClass != null)
                    {
                        <dt class="col-sm-4">–ù–∞—Å–ª–µ–¥—É–µ—Ç</dt>
                        <dd class="col-sm-8">
                            <a href="/@(Model.Class.StereoPath)/@(Model.Class.SubClass.Id).html" class="text-decoration-none">
                                @Model.Class.SubClass.Id
                            </a>
                        </dd>
                    }

                    @if (Model.Class.Stereotype == Stereotype.Class)
                    {
                        <dt class="col-sm-4">–°–≤–æ–π—Å—Ç–≤</dt>
                        <dd class="col-sm-8">@Model.Properties.Count</dd>
                    }

                    @if (Model.Class.Stereotype == Stereotype.Enum)
                    {
                        <dt class="col-sm-4">–ó–Ω–∞—á–µ–Ω–∏–π</dt>
                        <dd class="col-sm-8">@Model.Class.Descriptions.Count</dd>
                    }
                </dl>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="card mb-3">
            <div class="card-header">
                <h6 class="mb-0">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h6>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    <a href="/@(Model.Class.StereoPath)/_index.html" class="list-group-item list-group-item-action">
                        ‚Üê All @Model.Breadcrumbs[1].Name
                    </a>
                    @if (Model.Class.SubClass != null)
                    {
                        <a href="/@(Model.Class.StereoPath)/@(Model.Class.SubClass.Id).html"
                           class="list-group-item list-group-item-action">
                            ‚Üë Parent: @Model.Class.SubClass.Id
                        </a>
                    }
                    <a href="/index.html" class="list-group-item list-group-item-action">
                        üè† Home
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    HtmlString GetStereotypeBadge(Stereotype stereotype)
    {
        var displayText = stereotype switch
        {
            Stereotype.Class => "Class",
            Stereotype.Enum => "Enum",
            Stereotype.Primitive => "Primitive",
            Stereotype.DataType => "Data Type",
            _ => stereotype.ToString().ToUpper()
        };

        return new HtmlString($"<span class=\"badge {Class.BadgeClassStatic(stereotype)}\">{displayText}</span>");
    }
}