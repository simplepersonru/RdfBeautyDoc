@using RdfsBeautyDoc
@model PropertyListViewModel
@{
    Layout = "_Layout.cshtml";
}

<h1>Properties <small class="text-muted">(@Model.Properties.Count)</small></h1>
<p class="lead">Все свойства и связи в схеме</p>

<!-- Фильтры -->
<div class="row mb-4">
    <div class="col-md-12">
        <input type="text" class="form-control" id="propertyFilter"
               placeholder="Поиск по ID, Подписи, или типу...">
    </div>
</div>

<!-- Таблица свойств -->
<div class="table-responsive">
    <table class="table table-hover" id="propertiesTable">
        <thead class="table-light">
            <tr>
                <th>Свойство</th>
                <th>Подпись</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var prop in Model.Properties)
            {
                <tr class="searchable property-row"
                    data-id="@prop.Id.ToLower()"
                    data-label="@(prop.Label?.ToLower() ?? "")"
                    data-domain="@prop.Domain.Id.ToLower()"
                    data-range="@prop.Range.ToLower()">
                    <td>

                        <div class="d-flex flex-column gap-1">
                            <a href="/properties/@(prop.Id).html" class="fw-bold">@prop.Id</a>
                            <div class="d-flex flex-row gap-2">
                                <span>Тип</span>
                                <a href="/@(prop.Range.StereoPath)/@(prop.Range.Id).html" class="badge @(prop.Range.BadgeClass) text-decoration-none">
                                    @prop.Range
                                </a>
                                @if (!string.IsNullOrEmpty(prop.Multiplicity))
                                {
                                    <span class="ms-4">Количество</span>
                                    <span class="badge bg-info">@prop.Multiplicity</span>
                                }
                            </div>
                        </div>
                    </td>
                    <td>
                        @if (!string.IsNullOrEmpty(prop.Label))
                        {
                            <p>@prop.Label</p>
                        }
                        else
                        {
                            <p>—</p>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@if (!Model.Properties.Any())
{
    <div class="alert alert-info">
        <h4 class="alert-heading">No properties found</h4>
        <p>The schema doesn't contain any property definitions.</p>
    </div>
}

<script>
    // Фильтрация таблицы
    const propertyFilterInput = document.getElementById('propertyFilter');
    if (propertyFilterInput) {
        propertyFilterInput.addEventListener('input', filterProperties);
    }

    function filterProperties() {
        const searchQuery = propertyFilterInput ? propertyFilterInput.value.toLowerCase() : '';

        const rows = document.querySelectorAll('.property-row');
        let visibleCount = 0;

        rows.forEach(row => {
            const id = row.dataset.id || '';
            const label = row.dataset.label || '';
            const domain = row.dataset.domain || '';
            const range = row.dataset.range || '';

            const matches = !searchQuery ||
                          id.includes(searchQuery) ||
                          label.includes(searchQuery) ||
                          domain.includes(searchQuery) ||
                          range.includes(searchQuery);

            row.style.display = matches ? '' : 'none';
            if (matches) visibleCount++;
        });
    }
</script>